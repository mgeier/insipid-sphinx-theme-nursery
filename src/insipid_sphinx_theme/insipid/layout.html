{%- extends "basic/layout.html" %}


{# Turn comma-separated list into proper list #}
{% if theme_left_buttons is string and theme_left_buttons %}
{% set theme_left_buttons = theme_left_buttons.split(',')|map('trim') %}
{% endif %}
{% if theme_right_buttons is string and theme_right_buttons %}
{% set theme_right_buttons = theme_right_buttons.split(',')|map('trim') %}
{% endif %}


{% macro stripsectionnumber(title) %}
{%- if title.startswith('<span class="section-number">') %}
{{- title.split('</span>', 1)|last }}
{%- else %}
{{- title }}
{%- endif %}
{%- endmacro %}


{# Remove section numbers from title/next/previous/up/breadcrumbs links #}
{% if theme_strip_section_numbers %}
{% set title = stripsectionnumber(title) %}
{% if next %}
{% set next = namespace(next) %}
{% set next.title = stripsectionnumber(next.title) %}
{% endif %}
{% if prev %}
{% set prev = namespace(prev) %}
{% set prev.title = stripsectionnumber(prev.title) %}
{% endif %}
{% set new_parents = [] %}
{% for parent in parents %}
{% set parent = namespace(parent) %}
{% set parent.title = stripsectionnumber(parent.title) %}
{# Dummy assignment to be able to call append() #}
{% set _ = new_parents.append(parent) %}
{% endfor %}
{% set parents = new_parents %}
{% endif %}


{% block css %}
{{- super() }}
{%- if READTHEDOCS|tobool and render_sidebar %}
    <link rel="stylesheet" href="{{ pathto('_static/insipid-sidebar-readthedocs.css', 1) }}" type="text/css" />
{%- endif %}
{%- endblock %}


{% block scripts %}
{{ super() }}
    <script defer src="{{ pathto('_static/insipid.js', 1) }}"></script>
{%- if render_sidebar %}
    <script defer src="{{ pathto('_static/sidebar.js', 1) }}"></script>
{%- endif %}
{%- endblock %}


{% block extrahead %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
{%- endblock %}


{% block body_tag %}
  <body class="no-js{% if render_sidebar %} sidebar-visible{% endif %}">
{%- endblock %}


{% block header %}
    <script type="text/javascript">
        var body = $(document.body);
        body.removeClass('no-js');
        body.addClass('js');
{%- if render_sidebar %}
        body.addClass('loading');
        try {
            var sidebar = localStorage.getItem('sphinx-sidebar');
            if (sidebar === 'hidden') {
                body.removeClass('sidebar-visible');
                body.addClass('sidebar-hidden');
            }
            var sidebar_width = localStorage.getItem('sphinx-sidebar-width');
            if (sidebar_width) {
                $(':root').css('--sidebar-width', sidebar_width);
            }
        } catch(e) {
            body.removeClass('sidebar-visible');
            body.addClass('sidebar-hidden');
        }
{%- endif %}
    </script>
    <div id="topbar-placeholder">
      <div id="topbar">
        <div id="titlebar">
          <div class="buttons">
{%- if not theme_rightsidebar|tobool %}
{%- include 'sidebar-button.html' %}
{%- endif %}
{%- for buttontemplate in theme_left_buttons %}
{%- include buttontemplate %}
{%- endfor %}
          </div>
          <h1>
            {%- if parents %}
            <a class="parent" href="{{ parents[-1].link|e }}" {{ accesskey('U') }}>{{ parents[-1].title }}</a>
            {%- elif pagename == master_doc %}
            {#- NB: In the "singlehtml" builder docstitle is None #}
            <span class="parent">{{ docstitle|e if docstitle != None else title|e }}</span>
            {%- else %}
            <a class="parent" href="{{ pathto(master_doc)|e }}" {{ accesskey('U') }}>{{ docstitle|e }}</a>
            {%- endif %}
            <button class="top" type="button" onclick="$(document.scrollingElement).animate({scrollTop: 0}, 400).focus()">{{ title }}</button>
          </h1>
          <div class="buttons">
{%- for buttontemplate in theme_right_buttons %}
{%- include buttontemplate %}
{%- endfor %}
{%- if theme_rightsidebar|tobool %}
{%- include 'sidebar-button.html' %}
{%- endif %}
          </div>
        </div>
{%- if pagename != "search" and 'searchbox.html' not in sidebars %}
                {#-
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                </div>
                #}
        <div id="searchbox" role="search">
          <div id="searchform" class="hidden">
          {#-
          <h3 id="searchlabel">{{ _('Quick search') }}</h3>
          #}
            <form class="search" action="{{ pathto('search') }}" method="get">
              <!--
                aria-labelledby="searchlabel"
              -->
              <input type="search" id="searchbar" name="q" placeholder="{{ _('Search') + ' ...' }}" />
              <input type="submit" value="{{ _('Go') }}" />
            </form>
          </div>
        </div>
{%- endif %}
      </div>
    </div>
{#- TODO: config option to disable the nav buttons? #}
{%- if theme_body_max_width != None %}
    <nav>
{%- if prev %}
      <a href="{{ prev.link|e }}" class="nav-icon previous" title="{{ _('previous') }} (P):&#13;{{ prev.title|striptags }}" aria-label="{{ _('Previous topic') }}" {{ accesskey('P') }}>
        {% include 'icons/angle-left.svg' %}
      </a>
{%- endif %}
{%- if next %}
      <a href="{{ next.link|e }}" class="nav-icon next" title="{{ _('next') }} (N):&#13;{{ next.title|striptags }}" aria-label="{{ _('Next topic') }}" {{ accesskey('N') }}>
        {% include 'icons/angle-right.svg' %}
      </a>
{%- endif %}
    </nav>
{%- endif %}
{%- endblock %}


{% macro navbar() %}
    <nav class="navbar">
      {%- if prev %}
      <a class="previous" href="{{ prev.link|e }}" title="{{ _('Previous topic') }} (P)" {{ accesskey('P') }}>
        <div class="icon">
          {% include 'icons/arrow-left.svg' %}
        </div>
        <div class="title">
          <span class="text">
            <span class="direction">{{ _('previous') }}</span>
            {{ prev.title }}
          </span>
        </div>
      </a>
      {%- endif %}
      {%- if next %}
      <a class="next" href="{{ next.link|e }}" title="{{ _('Next topic') }} (N)" {{ accesskey('N') }}>
        <div class="title">
          <span class="text">
            <span class="direction">{{ _('next') }}</span>
            {{ next.title }}
          </span>
        </div>
        <div class="icon">
          {% include 'icons/arrow-right.svg' %}
        </div>
      </a>
      {%- endif %}
    </nav>
{%- endmacro %}


{% block relbar1 %}
{%- if theme_navbar_top|tobool %}
{{ navbar() }}
{%- endif %}
{%- endblock %}


{% block sidebar1 %}{% endblock %}


{% block sidebar2 %}{% endblock %}


{% block relbar2 %}
{%- if theme_navbar_bottom|tobool %}
{{ navbar() }}
{%- endif %}
{%- endblock %}


{% block footer %}
{{ sidebar() }}
{% block comments %}{% endblock %}
{% include 'footer.html' %}
{%- if render_sidebar %}
    <div class="sidebar-resize-handle"></div>
    <label id="overlay"></label>
    <!-- TODO: provide a re-usable function for this in .js file? -->
    <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
    <script type="text/javascript">
        document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
        document.querySelector('.sphinxsidebar').setAttribute('aria-hidden', sidebar !== 'visible');
        /*
        Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
            link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
        });
        */
    </script>
{%- endif %}
{%- endblock %}


{% block sidebarlogo %}
          <div class="sidebar-resize-handle"></div>
{{ super() }}
{% endblock %}
